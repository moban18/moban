<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <title>Dashboard</title>

    <meta name="description" content="Dashboard">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="shortcut icon" href="/assets/img/favicon.png" type="image/x-icon">


    <!--Basic Styles-->
    <link href="ADMIN_CSS/bootstrap.css" rel="stylesheet">
    <link href="ADMIN_CSS/font-awesome.css" rel="stylesheet">
    <link href="ADMIN_CSS/weather-icons.css" rel="stylesheet">

    <!--Beyond styles-->
    <link id="beyond-link" href="ADMIN_CSS/beyond.css" rel="stylesheet" type="text/css">
    <link href="ADMIN_CSS/demo.css" rel="stylesheet">
    <link href="ADMIN_CSS/typicons.css" rel="stylesheet">
    <link href="ADMIN_CSS/animate.css" rel="stylesheet">
    <style type="text/css">
        .goods_photo_box {
            width:120px;height: 30px;background:#2DC3E8;text-align:center;line-height:30px;letter-spacing: 5px;
            font-weight: 800;
        }
        .marginleft {
            margin-left: 20px;
        }

    </style>
</head>
<body>
<!-- 头部 -->
<include file="Public/head"/>

<!-- /头部 -->

<div class="main-container container-fluid">
    <div class="page-container">
        <!-- Page Sidebar -->
        <include file="Public/left"/>
        <!-- /Page Sidebar -->
        <!-- Page Content -->
        <div class="page-content">
            <!-- Page Breadcrumb -->
            <div class="page-breadcrumbs">
                <ul class="breadcrumb">
                    <li>
                        <a href="#">系统</a>
                    </li>
                    <li>
                        <a href="__CONTROLLER__/index">商品管理</a>
                    </li>
                    <li class="active">添加商品</li>
                </ul>
            </div>
            <!-- /Page Breadcrumb -->

            <!-- Page Body -->
            <div class="page-body">

                <div class="row">
                    <div class="col-lg-12 col-sm-12 col-xs-12">
                        <div class="widget">
                            <div class="widget-header bordered-bottom bordered-blue">
                                <span class="widget-caption">商品基本信息</span>
                            </div>
                            <div class="widget-body">
                                    <form class="form-horizontal" role="form" action="" method="post" enctype="multipart/form-data">
                                        <input type="hidden" name="id" value="{$goodss['id']}"/>
                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品标题：</label>
                                            <div class="col-sm-6">
                                                <input class="form-control"  placeholder="" name="goods_name" required="" type="text" value="{$goodss['goods_name']}">
                                            </div>
                                            <p class="help-block col-sm-4 red">* 必填</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">搜索规则：</label>
                                            <div class="col-sm-6">
                                                <div id="box">
                                                    <volist name="searches" id="v">
                                                        <if condition="$v['attr1_name'] neq '' ">
                                                            <p>规则{$v.id}：{$v['attr1_name']}--{$v['attr2_name']}--{$v['attr_name']}<a class="btn btn-danger btn-sm shiny marginleft" href="__CONTROLLER__/delSearch/id/{$v['id']}">删除</a></p>
                                                            <else/>
                                                            <p>规则{$v.id}：{$v['attr2_name']}--{$v['attr_name']}<a class="btn btn-danger btn-sm shiny marginleft" href="__CONTROLLER__/delSearch/goods_id/<?php echo $_GET['id'];?>/id/{$v['id']}">删除</a></p>
                                                        </if>

                                                    </volist>

                                                    <p class="help-block col-sm-6 red">注意：以上的规则只能删除，若要添加<a href="{:U('Admin/Search/add',array('id'=>$_GET['id']))}">点击这里</a></p>
                                                </div>


                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">发布时间：</label>
                                            <div class="col-sm-2">
                                                <input class="form-control"  placeholder="" name="goods_time" required="" type="text" value="<?php echo date('Y-m-d H:i:s',$goodss['goods_time']);?>">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">属于栏目：</label>
                                            <div class="col-sm-6">
                                                <select name="cate_id" id="cate_id" class="selected">
                                                    <option>选择栏目</option>
                                                    <volist name="cates" id="v">
                                                        <option <if condition="$v['id'] eq $goodss['cate_id']">selected="selected"</if> value="{$v['id']}">{$v['cate_name']}</option>
                                                    </volist>
                                                </select>
                                            </div>
                                        </div>

                                        <?php if($goodss['cate_id']!=3):?>
                                        <div id="goods_auth" class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px; color:#C55407">下载权限：</label>
                                            <?php $goods_vips=explode(',',$goodss['goods_vips']);?>
                                            <?php foreach($vips as $v):
                                                    if(in_array($v['id'],$goods_vips)){
                                                        $checked='checked="checked"';
                                                    }else{
                                                        $checked='';
                                                    }
                                            ?>
                                            <div class="col-lg-1 col-sm-1 col-xs-1"> <div class="checkbox"> <label> <input type="checkbox" class="colored-blue" name="goods_vips[]" value="{$v['id']}" <?php echo $checked;?> > <span class="text" style="color:#036F9E">{$v['vip_name']}</span> </label> </div> </div>
                                            <?php endforeach;?>
                                        </div>
                                        <?php endif;?>
                                        <!--asfdsfdsfds-->

                                        <div id="goods_price" class="form-group" style="margin-top:10px;">
                                            <label for="goods_price" class="col-sm-2 control-label " style="text-align:right;padding-top:5px;color:#C55407">模板价格：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control" name="goods_price" required="" value="{$goodss['goods_price']}" type="text">                                            </div>
                                            <p class="help-block col-sm-4 red">*模板必要填价格</p>
                                        </div>




                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">属于种类：</label>
                                            <div class="col-sm-6">
                                                <select name="attrtype_id" id="attrtype_id" class="selected">
                                                    <option>选择种类</option>
                                                    <volist name="attrtypes" id="v">
                                                        <option <if condition="$v['id'] eq $goodss['attrtype_id']">selected="selected"</if> value="{$v['id']}">{$v['attrtype_name']}</option>
                                                    </volist>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group" style="margin-top:10px;" >
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">模板数：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control"  placeholder="" name="moban_num" required="" type="text" value="{$goodss['moban_num']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;" >
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品浏览量：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control"  placeholder="" name="goods_comment" required="" type="text" value="{$goodss['goods_comment']}">

                                            </div>
                                        </div>
                                        <div class="form-group" >
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品收藏量：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control"  placeholder="" name="goods_store" required="" type="text" value="{$goodss['goods_store']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品评论量：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control"  placeholder="" name="goods_recommend" required="" type="text" value="{$goodss['goods_recommend']}">

                                            </div>
                                        </div>
                                        <div class="form-group " style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品下载量：</label>
                                            <div class="col-sm-1">
                                                <input class="form-control"  placeholder="" name="download_num" required="" type="text" value="{$goodss['download_num']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品作者：</label>
                                            <div class="col-sm-4">
                                                <input class="form-control"  placeholder="" name="goods_author" required="" type="text" value="{$goodss['goods_author']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品演示地址：</label>
                                            <div class="col-sm-4">
                                                <input class="form-control"  placeholder="" name="goods_view" required="" type="text" value="{$goodss['goods_view']}">

                                            </div>
                                        </div>
                                        <div style="clear: both"></div>
                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品下载地址：</label>
                                            <div class="col-sm-4">
                                                <input class="form-control"  placeholder="" name="download_url" required="" type="text" value="{$goodss['download_url']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">手机演示二维码地址：</label>
                                            <div class="col-sm-4">
                                                <input class="form-control"  placeholder="" name="code_url" required="" type="text" value="{$goodss['code_url']}">

                                            </div>
                                        </div>

                                        <div class="form-group" style="margin-top:10px;">
                                            <span for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">商品首页图片：</span>
                                            <div class="col-sm-4">
                                                <label for="goods_photo"><img src="ADMIN_IMG/upload.png"></label>
                                                <input type="file" id="goods_photo" multiple style="display:none;" >
                                                <if condition="$goodss['goods_photo'] neq '' ">
                                                <i id="app">
                                                    <img alt="'+data+'" id="goods_photo_link" src="__ROOT__/{$goodss['goods_photo']}"/>
                                                    <input id="hid_photo" name="goods_photo" value="{$goodss['goods_photo']}" type="hidden">
                                                    <input id="hid_photo_small" name="godds_233_160" value="{$goodss['godds_233_160']}" type="hidden">

                                                </i>
                                                </if>
                                            </div>
                                            <p class="help-block col-sm-4 red">*直接上传新的图片就会自动修改</p>
                                        </div>

                                        <div class="form-group">
                                            <label for="username" class="col-sm-2 control-label no-padding-right">是否推荐：</label>
                                            <div class="col-xs-4">
                                                    <input class="checkbox-slider yesno" name="goods_tuijian" value="1" type="checkbox" <?php if($goodss['goods_tuijian']==1){echo $checked='checked="checked"';}?> >


                                                <span class="text"></span>
                                                </label>
                                            </div>
                                        </div>


                                        <div class="form-group" style="margin-top:10px;">
                                            <label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px">内容详情：</label>
                                            <div class="col-sm-4">
                                                <textarea id='goods_content' name="goods_content">{$goodss['goods_content']}</textarea>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-sm-offset-2 col-sm-10">
                                                <button type="submit" class="btn btn-default">保存信息</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- /Page Body -->
                </div>
                <!-- /Page Content -->
            </div>
        </div>

        <!--Basic Scripts-->
        <script src="ADMIN_CSS/jquery_002.js"></script>
        <script src="ADMIN_CSS/bootstrap.js"></script>
        <script src="ADMIN_CSS/jquery.js"></script>
        <!--Beyond Scripts-->
        <script src="ADMIN_CSS/beyond.js"></script>
        <script src="EDITOR/ueditor.config.js"></script>
        <script src="EDITOR/ueditor.all.min.js"></script>
        <script>
            var et=UE.getEditor('goods_content',{
                initialFrameWidth:850,
                initialFrameHeight:320
            });
            //模板选择栏目时，select下出现不同的选择
            $('#cate_id').change(function(){
                var cate_id=$(this).val();
                var html='';
                var html2='';
                var div=$('#goods_auth');
                div.html('');
                if(cate_id!=3){
                    $.ajax({
                        type:'post',
                        url:'__CONTROLLER__/getVip',
                        data:cate_id,
                        success:function(data) {
                            var a = eval(data);
                            html = '<label for="username" class="col-sm-2 control-label " style="text-align:right;padding-top:5px; color:#C55407">下载权限：</label>';
                            $(a).each(function (k, v) {
                                html += ' <div class="col-lg-1 col-sm-1 col-xs-1"> <div class="checkbox"> <label> <input type="checkbox" class="colored-blue" name="goods_vips[]" value="' + v.id + '" > <span class="text" style="color:#036F9E">' + v.vip_name + '</span> </label> </div> </div>';
                            });

                            div.html(html);
                        }

                    });


                }
            });


            //上传图片与CONTROLLER交换数据
            $('#goods_photo').change(function(){
                var img=$("#goods_photo")[0].files[0];
                var size = img.size;
                var value1 =$("#goods_photo")[0].value;
                var types='gif,jpeg,jpg,png,bmp';
                var prech=/.(gif|jpg|jpeg|png|GIF|JPG|bmp)$/;
                var big=2*1024;
                var html='';
                var src=$('#hid_photo').val();
                var smallSrc=$('#hid_photo_small').val();
                var i=$('#app');
                if(!prech.test(value1)){
                    alert('错误！请上传指定文件类型');
                }
                if(!size>big){
                    alert('错误！上传文本大于2M');
                }
                var data=new FormData();
                data.append('upload_file', img);
                $.ajax({
                    type:'post',
                    url:'__CONTROLLER__/uploadImg',
                    data:data,
                    contentType: false,
                    processData: false,
                    success:function(data){
                        if(src){
                            delPhoto(src);
                            delPhoto(smallSrc);
                            i.html('');
                        }
                        var photos=data.split(',');
                        html='<img alt="'+data[0]+'" id="goods_photo_link" src="__ROOT__'+photos[0]+'"/>';
                        html+='<input id="hid_photo" type="hidden" name="goods_photo" value="'+photos[0]+'" />';
                        html+='<input id="hid_photo_small" type="hidden" name="godds_233_160" value="'+photos[1]+'" />';
                        i.html(html);
                        $('#goods_photo').val('');

                    }
                });
            });
            //上传图片，把不要的图片从后台删除
            function delPhoto(src){
                $.ajax({
                    type:'post',
                    url:'__CONTROLLER__/delPhoto',
                    data:{
                        src:src,
                    },
                    success:function(data){
                        if(data==1){
                            $('#goods_photo').val('');
                        }
                   }
                });
            }







        </script>







</body>

</html>